---
layout: post
title: 3 - 도메인 복잡성 관리
tags: [DDD, Domain-Driven-Develop]
date: 2025-08-06 10:00:00 +0900
---

## 일관성 없는 모델

- 텔레마케팅 회사 예시 → 마케팅 부서는 온라인 광고를 통해 리드 생성 후, 영업 부서는 구매를 유도함
    
    ![3-1](/assets/images/ddd/3-1.png)
    
    - 여기서 Lead란 무엇을 의미할까?
        - 마케팅 부서 : 마케팅 담당자에게 리드는 누군가가 제품 중 하나에 관심이 있다는 알림을 나타냄, 잠재고객의 연락처 정보를 수신하는 이벤트는 리드로 간주
        - 영업 부서 : 리드는 영업 프로세스의 전체 수명주기를 나타냄, 리드는 단순한 이벤트가 아닌 장기적으로 진행되는 과정
- 어떻게 해야 부서마다 다른 뜻을 하나의 유비쿼터스 언어로 일관성있도록 할 수 있을까?
    
    → 사람들간의 다른 용어는 이야기를 하면서 추론할 수 있음
    
- 허나 소프트웨어로 표현하는 것은 더 어려움
    - 각 부서에서 코드로 옮길 때 마케팅 부서는 너무 단순하고, 영업 부서는 너무 복잡하게 됨

→ 어떻게 해야할까? 

- ERD ( Entity Relationship Diagram ) 을 생성
    - 단점 : 모든 세부사항을 추가하려다가 복잡성에 직면하게 됨
- 문맥상 정의에 문제가 있는 용어 앞에 접두사를 추가하는 것 → 두 가지 모델을 만듬
    - 문제점 1. 인지부하를 유발함 → 각 모델은 언제 사용해야할까?, 충돌하는 모델을 계속해서 구현할수록 실수하기 쉬움
    - 문제점 2. 모델의 구현이 유비쿼터스 언어와 일치하지 않음. 아무도 대화 앞에 접두사를 사용하지 않음

## 바운디드 컨텍스트란 무엇인가?

- 유비쿼터스 언어를 여러 개의 작은 언어로 나눈 다음 각 언어를 적용할 수 있는 명시적인 바운디드 컨텍스트에 할당
    
    ![3-2](/assets/images/ddd/3-2.png)
    
    - 어떤 의미에서 용어 충돌과 암시적 컨텍스트는 적당한 규모의 모든 비즈니스에 내재된 부분이다
        - 바인디드 컨텍스트 패턴을 사용하면 컨텍스트를 명시적이고 중요한 비즈니스 도메인의 요소로 모델링할 수 있다

### 모델 경계

- 모델은 실제 세계의 복사본이 아니라 복잡한 시스템을 이해하는데 도움을 주기 위해 구조화한 것
    - 우리가 해결하려는 문제는 모델 본연의 목적
    - 모델은 경계없이 존재할 수 없음
    - 경계가 없다면 현실 세계의 복제본처럼 확장됨
        - ex) 노선도에서 운행이 쓸모 없음

### 정제된 유비쿼터스 언어

- 비운디드 컨텍스트를 통해 유비쿼터스 언어의 정의를 완성할 수 있다.
    - 조직 전체에서 유비쿼터스 하게 사용하고 적용돼야 한다는 의미에서 유비쿼터스가 아님
- 유비쿼터스 언어는 바인디드 컨텍스트 경계 안에서만 보편적으로 적용된다
    - 유비쿼터스 언어는 바운디드 컨텍스트 경계 안에서만 보편적으로 적용됨
    - 모델을 설명하는 데만 집중
    - 모델은 위가 해결해야 하는 문제없이는 존재할 수 없기 때문에 유비쿼터스 언어는 명시적으로 적용 가능한 컨텍스트 없이 정의하거나 사용할 수 없다

### 바운디드 컨텍스트의 범위

- 서로 다른 도메인 전문가들은 동일한 비즈니스 엔티티에 대해 상충되는 멘탈 모델을 갖고 있었음
- 비즈니스 도메인을 모델링하기 위해 우리는 모델을 분할하고, 각 세분화된 모델에 적용 가능한 컨텍스트를 엄격하게 정의함
- 유비쿼터스 언어의 일관성은 해당 언어의 가장 넓은 경계를 식별하는 데 도움이 될 뿐이다
    - 일관성이 없는 모델과 용어가 있기 때문에 더 이상 커질 수 없다

![3-3](/assets/images/ddd/3-3.png)

- 유비쿼터스 언어의 범위를 정의하는 것은 전략적인 설계 의사결정
    - 경계는 비즈니스 도메인의 고유한 컨텍스트에 따라 넓힐 수도 있고
    - 비즈니스 도메인을 더 작은 문제 도메인으로 세분화하여 좁힐 수도 있음
- 크기 자체는 의사결정 요소가 아님
    - 크기에 정답은 없고, 모델 자체로 유용해야함
    - 유비쿼터스 언어의 경계가 넓을수록 일관성을 유지하기 더 어려워짐
- 큰 유비쿼터스 언어를 더 작고 관리하기 쉬운 문제 도메인으로 나눈 것은 도움이 될 수 있지만, 바운디드 컨텍스트를 작게 만들기 위해 노력하는 것은 역효과 날 수 있음 → 설계를 통합하는 오버헤드가 커짐
    - 크기에 대한 결정은 문제 도메인이 무엇이냐에 따라 달라짐
    - 떄로는 넓은 경계를 사용하는 것이 명확하고, 어떤 경우에는 분해하는 것이 더 합리적
- 큰 바운디드 컨텍스트에서 세분화된 바운디드 컨텍스트를 추출하는 이유는 새로운 소프트웨어 엔지니어링 팀을 구성하거나 시스템의 일부 비기능 요구사항을 해결하는 것이 포함됨
    - ex) 단일 바운디드 컨텍스트에 있던 일부 컴포넌트의 개발 수명주기를 분리해야하는 경우
    - 바운디드 컨텍스트의 나머지 기능과 독립적으로 확장할 수 있어서
- 모델을 유용하게 유지하고 바운디드 컨텍스트의 크기를 비즈니스 요구사항과 조직의 제약사항에 맞춰라
    - 주의할점 : 응집된 기능을 여러 바운디드 컨텍스트로 분할하는 것
        
        → 각 컨텍스트가 독립저긍로 발전하는 능력을 저해함 + 같은 비즈니스 요구사항과 변경사항은 바운디드 컨텍스트에 동시에 영향을 끼치고 변경에 대한 동시 배포가 요구됨
        

## 바운디드 컨텍스트 대 하위 도메인

- 처음에는 바운디드 도메인을 분해하는 두 가지 방법이 중복으로 보일 수 있다
    - 하지만 그렇지 않다, 두 경계가 모두 필요한 이유를 살펴보자

### 하위 도메인

- 기업의 비즈니스 전략을 이해하려면 비즈니스 도메인을 분석해야함
- 도메인 주도 설계 방법론에 따르면 분석 단계에는 다양한 하위 도메인을 식별하는 작업이 포함됨
    
    → 조직이 일하고 경쟁 전략을 계획하는 방식
    
- 유스케이스는 비즈니스 도메인과 시스템 요구사항에 따라 정의됨
    - 소프트웨어 엔지니어로서 우리는 요구사항을 정의하지 않음 → 비즈니스가 담당
    - 대신 소프트웨어 엔지니어는 하위 도메인을 식별하기 위해 비즈니스 도메인을 분석

### 바운디드 컨텍스트

- 반면에 바운디드 컨텍스트는 소프트웨어 엔지니어에 의해 설계됨
- 모델의 경계를 선택하는 것은 전략적 설계의 의사결정
- 우리는 비즈니스 도메인을 더 작고 관리 가능한 문제 도메인으로 어떻게 나눌지 정함

### 하위 도메인과 바운디드 컨텍스트 사이의 상호작용

- 비현실적이지만 이론적으로는 단일 모델이 전체 비즈니스 도메인에 적용될 수 있음
    - 이 전략은 소규모 시스템에서 효과적
        
        ![3-4](/assets/images/ddd/3-4.png)
        
    - 모델이 충돌하면 도메인 전문가의 멘탈 모델에 따라 시스템을 바운디드 컨텍스트로 분해 가능
        
        ![3-5](/assets/images/ddd/3-5.png)
        
    - 모델이 여전히 크고 유지보수하기 어려운 경우 더 작은 바운디드 컨텍스트로 분해 가능
        - ex) 각 하위 도메인에 대한 바운디드 컨텍스트로 나눌 수 있음
        
        ![3-6](/assets/images/ddd/3-6.png)
        
- 어떤 시나리오에서 바운디드 컨텍스트와 하위 도메인 간에 일대일 관계를 맺는 것이 완벽하게 합리적일때가 많다
    - 반면 어떤 경우에는 다른 분해 전략이 더 적합할 수 있음
- 중요한 것은 하위 도메인은 발견하고 바운디드 컨텍스트는 설계한다는 점
    - 하위 도메인은 비즈니스 전략에 의해 정의됨
    - 그러나 소프트웨어 엔지니어는 특정 프로젝트의 컨텍스트와 제약 조건을 해결하기 위해 소프트웨어 솔루션과 바운디드 컨텍스트를 설계할 수 있음

## 경계

> 건축 설계는 시스템 설계다. 시스템 설계는 상황에 맞는 설계다. 본질적으로 경계와 균형에 관한 것이다. 내부의 모양을 구성하는 것처럼 외부의 모양도 재구성한다 - 루스 말란
> 

- 바운디드 컨텍스트 패턴은 물리적 경계와 소유권 경계를 규정하기 위한 도메인 주도 설계 도구다

### 물리적 경계

- 바운디드 컨텍스트는 모델 경계뿐만 아니라 이를 구현하는 시스템의 물리적 경계 역할도 함
- 각 바운디드 컨텍스트는 개별 서비스/프로젝트로 구현돼야 한다
    - 구현, 진화, 버전 관리를 각각의 다른 바운디드 컨텍스트와 독립적으로 해야함
- 바운디드 컨텍스트 간의 명확한 물리적 경계를 통해 각 바운디드 컨텍스트를 요구사항에 가장 적합한 기술 스택으로 구현할 수 있음
    - 바운디드 컨텍스트는 여러 하위 도메인을 포함할 수 있음
    - 이러한 경우 바운디드 컨텍스트는 물리적 경계고 하위 도메인은 논리적 경계
    - 논리적 경계는 프로그래밍 언어의 종류에 따라 네임스페이스나 모듈, 패키지 같은 다른 이름을 갖음

### 소유권 경계

- 좋은 담장은 실제로 좋은 이웃을 만든다는 연구처럼, 이웃과 잘 지내기 위해서는 서로 간에 독립성과 존중을 유지하는 것이 필요
    - 프로젝트에서도 팀 간의 평화로운 공존을 위해 모델 경계를 활용할 수 있음
    - 팀 간의 작업 분배는 바운디드 컨텍스트 패턴을 사용하여 내릴 수 있는 또 다른 전략적 의사결정
- 바운디드 컨텍스트는 한팀에서만 구현, 발전, 유지 관리해야함
    - 두 팀에서 작업 X
    - 이러한 분리는 팀이 서로의 모델에 대해 만들 수 있는 암묵적인 가정을 제거
    - 대신 팀은 서로 다른 바운디드 컨텍스트로 분리된 모델과 시스템을 명시적으로 연동하기 위한 통신 프로토콜을 정의해야함
        
        → 팀과 바운디드 컨텍스트 간의 관계는 단방향
        

![3-7](/assets/images/ddd/3-7.png)

## 실생활의 바운디드 컨텍스트

- 실제로 바운디드 컨텍스트는 비즈니스 도메인과 하위 도메인 만큼 분명하지는 않지만, 도메인 전문가의 멘탈 모델이 잇는 것처럼 존재함
    - 엔지니어는 도메인 전문가가 다양한 비즈니스 엔티티와 프로세스에 대해 어떻게 생각하는지 의식해야함

### 시멘틱 도메인

- DDD의 바운디드 컨텍스트는 시맨틱 도메인의 사전적 개념에 기반한다고 볼 수 있음
    - 시맨틱 도메인 : 특정 주제나 분야 대한 지식과 정보를 체계적으로 구조화하고 표현하는 것을 의미
    - 의미 영역과 해당 의미를 전달하기 위해 사용하는 단어 영역으로 구분
        - 모니터
        - 포트
        - 프로세서
    - 서로 다른 시맨틱 도메인의 다소 특이한 예는 토마토
        - 식물학적 정의에 따르면 과일은 식물이 씨앗을 퍼뜨는 방식
        - 과일은 식물의 꽃에서 자라야 하고 적어도 하나의 씨가 있어야 한다
        - 반면 채소는 식물의 식용 가능한 모든 부분인 뿌리, 줄기, 잎을 포괄하는 일반 용어
            
            → 이 정의에 따르면 토마토는 과일이다
            
- 그러나 그 정의는 요리의 맥락에서 거의 사용되지 않음
    - 요리의 맥락에서 과일과 채소는 향미 프로필에 따라 정의됨
    - 과일은 식감이 부드럽고 단맛이나 신맛이 나며 생으로 있는 반면 채소는 식감이 더 질기고 맛이 떫으며 종종 요리해서 먹어야 함
        
        → 이 정의에 따르면 토마토는 채소 
        

→ 바운디드 컨텍스트에 따라서 토마토는 달라짐 

### 과학

> 과학자들은 일반적으로 어떤 이론도 100% 정확하지 않다는데 동의한다. 그러므로 지식의 진정한 시험은 진리가 아니라 효용이다 - 유발 노아 하라리
> 

→ 모든 경우에 맞는 과학적 이론은 없다. 다른 이론은 다른 맥락 안에서 유용하다

- 아이작 뉴턴과 아인슈타인이 도입한 서로 다른 중력 모델로 입증됨
    - 주장이 달라 모순되는 것처럼 보일 수 있지만, 적절한 바운디드 컨텍스트에서는 유용함

### 냉장고 구입

- **골판지 판은 단순한 부품이 아니라 도메인 모델이다.**
    - 예: 냉장고 입구에 깔린 골판지는 냉장고가 부엌에 들어갈 수 있는지 측정하는 문제를 해결하는 모델임.
    - 이는 “모델은 문제를 해결하기 위해 존재한다”는 DDD(도메인 주도 설계) 철학을 보여줌.
- **하나의 도메인에 대해 여러 모델이 가능하며, 작업 목적에 따라 다른 모델이 필요하다.**
    - 같은 냉장고에 대해, 측정 기준이 다르면 서로 다른 모델(3D 모델, 골판지 판 등)을 사용할 수 있음.
    - 모델은 해당 작업에 불필요한 정보는 생략되어야 하며, 과도하게 복잡할 필요 없음.
- **모델이란 유용한 추상화일 뿐이며, 정확한 복제는 목표가 아니다.**
    - 냉장고와 관련된 AR 애플리케이션 사례에서도, 목적이 “들어갈 수 있는지 확인하는 것”이라면 간단한 골판지 모델이면 충분함.
- **결론:**
    - 도메인마다 **바운디드 컨텍스트**를 분리하고, 각 컨텍스트마다 적절한 **유비쿼터스 언어**와 모델을 설계해야 한다.
    - 모델 간의 의미 충돌이 있다면 도메인을 나누고 명확히 경계를 정의해야 함.